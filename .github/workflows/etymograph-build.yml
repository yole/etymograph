name: Export read-only database
on: [push, workflow_dispatch]
jobs:
  export-database:
    timeout-minutes: 10
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v3

      - name: Start backend
        run: docker compose up backend --build --detach --wait

      - name: Create export target directory
        run: mkdir export

      - name: Generate exported data
        run: docker compose up frontend-export

      - name: Show logs
        if: always()
        run: docker logs etymograph-backend-1

      - name: Inspect health check
        if: always()
        run: docker inspect etymograph-backend-1

      - name: Stop containers
        if: always()
        run: docker compose down
